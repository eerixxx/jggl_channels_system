# Руководство пользователя: Система управления Telegram-каналами

## Содержание

1. [Введение](#введение)
2. [Быстрый старт](#быстрый-старт)
3. [Работа с каналами](#работа-с-каналами)
4. [Создание и публикация постов](#создание-и-публикация-постов)
5. [Автоперевод](#автоперевод)
6. [Статистика](#статистика)
7. [Форматирование текста](#форматирование-текста)
8. [FAQ](#faq)

---

## Введение

Система управления Telegram-каналами позволяет:

- Управлять группами каналов (основной канал + локализованные версии на разных языках)
- Создавать мультиканальные посты с автоматическим переводом
- Публиковать контент во все каналы одновременно
- Отслеживать статистику по каналам и постам

### Основные понятия

- **Группа каналов** — объединение связанных каналов (например, основной английский канал + русский, немецкий, испанский и т.д.)
- **Основной канал** — канал-источник контента (обычно на английском языке)
- **Мультиканальный пост** — пост, который публикуется во все каналы группы с переводом на соответствующие языки
- **Канальный пост** — конкретная версия поста для одного канала

---

## Быстрый старт

### Шаг 1: Подключение бота к каналу

1. Добавьте бота в ваш Telegram-канал как администратора
2. Предоставьте боту права:
   - Публикация сообщений
   - Редактирование сообщений (опционально)
   - Удаление сообщений (опционально)

### Шаг 2: Регистрация канала в системе

1. Войдите в админ-панель: `http://your-server/admin/`
2. Перейдите в раздел **Telegram Channels → Channels**
3. Нажмите **Add Channel**
4. Заполните данные:
   - **Telegram chat ID**: ID вашего канала (например, `-1001234567890`)
   - **Title**: Название канала
   - **Username**: @username канала (если есть)
   - **Language**: Выберите язык канала
5. Сохраните канал
6. Нажмите действие **"Verify bot permissions"** для проверки прав бота

### Шаг 3: Создание группы каналов

1. Перейдите в **Telegram Channels → Channel Groups**
2. Нажмите **Add Channel Group**
3. Введите название группы
4. Сохраните группу
5. Добавьте каналы в группу (отредактируйте каждый канал, выбрав группу)
6. Назначьте основной канал (отметьте **Is primary** у нужного канала)

---

## Работа с каналами

### Просмотр списка каналов

В разделе **Telegram Channels → Channels** вы можете:

- Видеть все зарегистрированные каналы
- Фильтровать по группе, языку, статусу
- Видеть статус бота (готов/не настроен)
- Видеть количество подписчиков

### Статусы бота

| Статус | Описание |
|--------|----------|
| ✓ Ready | Бот настроен и может публиковать |
| ⚠ Limited | Бот является админом, но не может публиковать |
| ✗ Not configured | Бот не добавлен или не имеет прав |

### Синхронизация данных канала

1. Выберите канал(ы)
2. Используйте действие **"Sync channel statistics"**

Это обновит:
- Количество подписчиков
- Название канала
- Описание
- Права бота

---

## Создание и публикация постов

### Создание нового поста

1. Перейдите в **Posts → Multi-Channel Posts**
2. Нажмите **Add Multi-Channel Post**
3. Заполните форму:

| Поле | Описание |
|------|----------|
| Group | Выберите группу каналов |
| Internal title | Название поста для себя (не публикуется) |
| Primary channel | Основной канал (источник текста) |
| Primary text markdown | Текст поста в формате Markdown |
| Primary photo | Фото для поста (опционально) |
| Auto translate enabled | Включить автоперевод |

4. Нажмите **Save**

После сохранения автоматически создаются версии поста для всех каналов группы.

### Редактирование версий для разных каналов

1. Откройте созданный пост
2. В нижней части страницы видны все **Channel Posts**
3. Нажмите на нужную версию для редактирования
4. Вы можете:
   - Изменить текст
   - Загрузить другое фото
   - Пометить как вручную отредактированный

### Публикация поста

**Публикация во все каналы:**
1. Выберите пост(ы) в списке
2. Используйте действие **"Publish all channel posts"**

**Публикация только готовых:**
1. Выберите пост(ы)
2. Используйте действие **"Publish ready channel posts only"**

**Публикация отдельных версий:**
1. Перейдите в **Posts → Channel Posts**
2. Выберите нужные версии
3. Используйте действие **"Publish selected posts"**

### Статусы постов

**MultiChannelPost:**
| Статус | Описание |
|--------|----------|
| Draft | Черновик |
| Ready for Publish | Готов к публикации |
| Publishing | В процессе публикации |
| Published | Опубликован во всех каналах |
| Partially Published | Опубликован частично (есть ошибки) |
| Failed | Не удалось опубликовать |

**ChannelPost:**
| Статус | Описание |
|--------|----------|
| Draft | Черновик |
| Pending Translation | Ожидает перевода |
| Pending Publish | Ожидает публикации |
| Publishing | Публикуется |
| Published | Опубликован |
| Failed | Ошибка публикации |

---

## Автоперевод

### Как работает автоперевод

1. При создании поста с включенным **Auto translate enabled**:
   - Текст основного канала автоматически отправляется на перевод
   - Для каждого языка группы создается переведенная версия
   - После получения перевода статус меняется на **Draft**

2. Вы можете:
   - Отредактировать перевод вручную
   - Запросить повторный перевод
   - Отключить автоперевод для конкретного канала

### Запрос автоперевода

1. Откройте **Multi-Channel Post**
2. Выберите посты
3. Используйте действие **"Request auto-translations"**

### Отключение автоперевода для канала

1. Откройте версию поста для канала (**Channel Post**)
2. Измените **Source type** на **Manual**
3. Введите текст вручную

---

## Статистика

### Общая статистика

В разделе **Statistics** доступны:

- **Channel Snapshots** — исторические данные по каналам
- **Global Snapshots** — агрегированная статистика по группам
- **Post Stats** — статистика по отдельным постам
- **Daily Stats** — ежедневная статистика

### Метрики каналов

| Метрика | Описание |
|---------|----------|
| Subscribers | Количество подписчиков |
| Views last 10 posts | Просмотры последних 10 постов |
| ER | Engagement Rate = (реакции + комментарии + репосты) / подписчики × 100% |
| ERR | Engagement Rate by Reach = (реакции + комментарии) / просмотры × 100% |

### Просмотр роста подписчиков

В разделе **Channel Stats Snapshots** можно видеть:
- Текущее количество подписчиков
- Прирост за 24 часа
- Прирост за 7 дней
- Прирост за 30 дней

### API статистики

Статистика доступна через API:

```
GET /api/v1/stats/overview/           # Общий обзор
GET /api/v1/stats/channel/{id}/growth/ # Рост канала
GET /api/v1/stats/group/{id}/comparison/ # Сравнение каналов в группе
```

---

## Форматирование текста

### Поддерживаемые форматы

Система поддерживает **Markdown** для ввода текста. При публикации текст автоматически конвертируется в формат Telegram.

### Синтаксис Markdown

| Форматирование | Markdown | Результат |
|----------------|----------|-----------|
| Жирный | `**текст**` | **текст** |
| Курсив | `*текст*` | *текст* |
| Подчеркнутый | `__текст__` | подчеркнутый |
| Зачеркнутый | `~~текст~~` | ~~текст~~ |
| Моноширинный | `` `код` `` | `код` |
| Ссылка | `[текст](url)` | [текст](url) |
| Блок кода | ` ```код``` ` | блок кода |

### Примеры

**Исходный Markdown:**
```markdown
**Важная новость!**

Мы рады сообщить о *запуске нового продукта*.

Подробности на [нашем сайте](https://example.com).

Используйте код `PROMO2024` для скидки.
```

**Результат в Telegram:**

<b>Важная новость!</b>

Мы рады сообщить о <i>запуске нового продукта</i>.

Подробности на <a href="https://example.com">нашем сайте</a>.

Используйте код <code>PROMO2024</code> для скидки.

### Ограничения Telegram

⚠️ **Внимание:** Telegram поддерживает ограниченный набор HTML-тегов:

- `<b>`, `<strong>` — жирный
- `<i>`, `<em>` — курсив
- `<u>` — подчеркнутый
- `<s>`, `<del>` — зачеркнутый
- `<code>` — моноширинный
- `<pre>` — блок кода
- `<a href="...">` — ссылка
- `<blockquote>` — цитата

Другие HTML-теги будут автоматически удалены.

### Максимальная длина сообщения

- Текстовое сообщение: **4096 символов**
- Подпись к фото: **1024 символа**

---

## FAQ

### Как узнать chat_id канала?

1. Добавьте бота @userinfobot в канал
2. Он покажет chat_id канала
3. Или используйте Telegram Bot API: `getChat`

### Почему бот не может публиковать?

Проверьте:
1. Бот добавлен в канал как администратор
2. У бота есть право "Публикация сообщений"
3. В системе статус бота показывает "Ready"

### Как отменить публикацию?

После отправки сообщения в Telegram его можно только:
- Отредактировать (если у бота есть права)
- Удалить (если у бота есть права)

В админ-панели изменение статуса не удалит сообщение из канала.

### Почему перевод некачественный?

Автоперевод использует LLM и может быть несовершенным. Рекомендуем:
1. Проверять переводы перед публикацией
2. Редактировать вручную критически важные тексты
3. Использовать простые и понятные формулировки в оригинале

### Как добавить новый язык?

1. Перейдите в **Telegram Channels → Languages**
2. Добавьте новый язык (код ISO, название)
3. Создайте канал с этим языком
4. Добавьте канал в группу

### Как часто обновляется статистика?

- Статистика каналов: каждый час
- Статистика постов: каждые 10-15 минут
- Агрегированная статистика: ежедневно

---

## Техническая поддержка

При возникновении проблем:

1. Проверьте логи в **Status** (`/status/`)
2. Проверьте статус Celery (`/celery/`)
3. Проверьте health check (`/health/`, `/ready/`)

Логи доступны в Grafana → Explore → Loki

